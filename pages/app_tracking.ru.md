---
title: Как отслеживаются приложения
description: Как отслеживаются приложения в Obtainium
---

# Как отслеживаются приложения

## Основные положения

Когда вы добавляете URL-адрес приложения в Obtainium, вы должны выбрать [источник](sources.md). Источники определяют, как информация о приложении и APK-файлы будут извлечены из введенного вами URL. В большинстве случаев Obtainium автоматически выбирает подходящий источник для использования - если это невозможно, появится выпадающий список «Переопределить источник».

Источники приложений должны предоставлять как минимум следующие данные для своих приложений:

- Версия приложения (или «псевдо-версия» - идентификатор, который меняется для каждой новой версии приложения)
- По крайней мере один URL-адрес загрузки соответствующий предоставленной версии APK

Источники приложений могут предоставлять и другую информацию - она позволяет использовать дополнительные функции или преимущества пользовательского интерфейса. Например:

- Имя автора приложения
- ID пакета приложения
- Дата выхода последней версии
- Информация о предыдущих версиях или вариантах приложения

В идеальном мире каждый источник приложений мог бы предоставлять всю необходимую информацию в стандартном формате и простым способом - по одному приложению на заданный URL-адрес. Однако часто это не так - существует множество различных способов обработки релизов приложений, даже из одного и того же источника, поэтому невозможно создать фиксированный набор шагов для их обработки. По этой причине при добавлении приложения вам предлагается несколько дополнительных опций, которые можно использовать для изменения способа извлечения информации о приложении. Хотя для большинства приложений будут работать параметры по умолчанию, вы можете захотеть разобраться в этих опциях, чтобы справиться с нестандартными ситуациями - дополнительную информацию см. в разделе [Источники Приложений](sources.md) ниже.

Примечание: Многие настройки фильтров в Obtainium (включая многие опциональные фильтры для конкретного источника) используют [регулярные выражения](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions) - вы должны быть знакомы с ними.

## Обнаружение версии

Когда Obtainium отслеживает установленное приложение, он получает версию приложения из Android и сравнивает ее со строкой версии, предоставленной источником. Затем он сравнивает эти две версии, чтобы определить, доступно ли обновление или изменился ли статус установки приложения. Такое сравнение возможно только в том случае, если две версии имеют одинаковый формат, что не всегда возможно. Например, может возникнуть любой из этих случаев:

1. [Obtainium](https://github.com/ImranR98/Obtainium/releases/tag/v0.14.21-beta) с GitHub:

    - **Отчетная версия приложения для Android:** `0.14.21`.
    - **Сообщаемая версия:** `v0.14.21-beta`. 

2. [Cheogram](https://git.singpolyma.net/cheogram-android/refs/2.12.8-2) из экземпляра SourceHut:

    - **Отчетная версия приложения для Android:** `2.12.8-2+free`.
    - **Объявленная версия:** `2.12.8-2`.

3. [Tor](https://www.torproject.org/download/) с веб-сайта Tor:

    - **Отчетная версия приложения для Android:** `102.2.1-Release (12.5.6)`.
    - **Отчетная версия источника:** нет (строка версии не предоставляется этим HTML-источником, поэтому вместо нее используется хэш URL в качестве "псевдо-версии")

4. [Quotable](https://github.com/Lijukay/Qwotable/releases/tag/v10) с GitHub:

    - **Отчетная версия приложения для Android:** `1`.
    - **Отчетная версия:** `v10`

Obtainium хранит список "стандартных" форматов, которые он использует для сравнения (например, `x.y.z` или `x.y`). Если обе сравниваемые версии соответствуют одному формату, сравнение будет выполнено. Если нет, то определение версии будет отключено для этого приложения. В некоторых случаях Obtainium удалит лишние части из исходной строки, если это приведет к стандартной версии (например, как удаляются `v` и `-beta` из Obtainium `v0.14.21-beta`), и тогда он сможет провести сравнение. Мы никогда не пытаемся удалять части из "настоящей" версии, предоставляемой ОС.

[Этот фрагмент кода](https://github.com/ImranR98/Obtainium/blob/main/lib/providers/apps_provider.dart#L64) определяет, как генерируются различные "стандартные" форматы.

Всегда есть возможность расширить этот код, чтобы добавить поддержку большего количества форматов, но это требует тщательного рассмотрения. Например, если Android сообщает, что версия установленного приложения - `1.2`, а в источнике говорится, что последняя доступная версия этого приложения - `1.2-4`, следует ли убрать `-4` и сказать, что они одинаковы (значит, обновления нет)? Это может быть нормально в некоторых контекстах (когда `-4` не указывает на изменения в самом приложении), но не в других контекстах. Поэтому не стоит поддерживать этот конкретный случай.

Отключение определения версий обычно не оказывает существенного влияния на повседневную работу. Если определение версий отключено для приложения, вы можете иногда сталкиваться с несоответствием между реальной версией приложения, установленной на вашей системе, и версией, отображаемой в пользовательском интерфейсе Obtainium. Это может произойти только в двух случаях:

1. Если версия приложения изменилась в результате действий, предпринятых вне Obtainium (например, если оно было обновлено в Google Play)
2. Если попытка Obtainium [обновить приложение в фоновом режиме](#фоновые-обновления) не удалась

В таких случаях Obtainium не сможет определить, что реальная версия ОС приложения изменилась, и не обновит свои внутренние записи соответствующим образом - вам придется вручную исправлять несоответствие.

См. также: [Obtainium Issue #946 Comment](https://github.com/ImranR98/Obtainium/issues/946#issuecomment-1741745587)

## Фоновые обновления

Obtainium регулярно проверяет наличие обновлений приложений в фоновом режиме. Вы можете управлять частотой этих обновлений на странице настроек.

После завершения фоновой проверки обновлений все доступные обновления делятся на 2 категории:

1. Обновления, которые могут быть применены в фоновом режиме
2. Обновления, которые не могут быть применены в фоновом режиме

Чтобы обновление автоматически устанавливалось в фоновом режиме (так называемое "тихое обновление"), должны соблюдаться определенные критерии:

- Операционная система должна быть Android 12 или выше
- Устанавливаемое приложение должно быть ориентированно на [последний уровень API Android](https://developer.android.com/reference/android/content/pm/PackageInstaller.SessionParams#setRequireUserAction(int))
- Текущая установленная версия приложения должна быть установлена из Obtainium
- У вас должны быть включены фоновые обновления в Obtainium (как для всех приложений, так и для этого приложения в частности - по умолчанию)
- Если для обновления доступно несколько APK, дополнительные параметры для этого приложения должны быть настроены таким образом, чтобы Obtainium мог отфильтровать их до одного APK

Каждое доступное обновление загружается и устанавливается, если это возможно, после чего пользователь получает уведомление либо о наличии обновления, либо о том, что оно было установлено в фоновом режиме.

Обратите внимание, что из-за технических ограничений фоновые обновления могут устанавливаться только асинхронно, по мере необходимости. Поэтому если фоновое обновление не удастся установить, вы не получите уведомления об ошибке.
